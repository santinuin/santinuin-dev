---
import Layout from "../layouts/Layout.astro";
import Button from "../components/Button.astro";
import DetailContainer from "../components/DetailContainer.astro";
import { getCollection } from "astro:content";

const sections = await getCollection("sections");

const sectionFromSearchParam = Astro.url.searchParams.get("section");
const currentSection =
  sections.find((sec) => sec.slug === sectionFromSearchParam) ||
  sections.find((sec) => sec.slug === "about");
const { body, data } = currentSection!;
const { title } = data;
---

<Layout>
  <main>
    <h1>Santiago Nu√±ez Ingas</h1>

    <div class="buttons-container">
      {
        sections.map((section) => {
          const { slug, data } = section;
          const { title } = data;

          return <Button text={title.toUpperCase()} section={slug} />;
        })
      }
    </div>

    <div class="content-container">
      <DetailContainer title={title}>
        <p>{body}</p>
      </DetailContainer>
    </div>
  </main>
</Layout>

<script define:vars={{ sections, sectionFromSearchParam }}>
  window.addEventListener("sectionChange", (event) => {
    const section = event.detail;
    const content =
      sections.find((sec) => sec.slug === section) ||
      sections.find((sec) => sec.slug === "about");

    document.querySelector("#detail-container h2").textContent =
      content.data.title;
    document.querySelector("#detail-container p").textContent = content.body;
  });
</script>

<style>
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    max-width: 800px;
    margin: auto;
  }

  .buttons-container {
    display: flex;
    justify-content: center;
    margin-top: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
    padding: 0 1rem;
  }

  .content-container {
    max-width: 800px;
    margin: auto;
    padding: 2rem;
    text-align: center;
  }
</style>
